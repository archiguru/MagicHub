name: Auto Sync
run-name: è‡ªåŠ¨åŒæ­¥å·¥ä½œæµ-${{ github.run_id }}
on:
  workflow_dispatch:
  schedule:
    - cron: "20 5 * * *"
 
jobs:
  Auto-Sync-Files: 
    runs-on: ubuntu-latest
    steps:
      - name: å…‹éš† MagicHub
        uses: actions/checkout@v4

      - name: å…‹éš† blackmatrix7's repo
        uses: actions/checkout@v4
        with:
          repository: blackmatrix7/ios_rule_script
          path: ios_rule_script
          
      - name: åŒæ­¥ ios_rule_script
        run: |
          echo "******  ğŸš— å¼€å§‹åŒæ­¥æ–‡ä»¶  ******"
          mkdir -p blank external icon rewrite rule/surge rule/adguard script
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/blank/ blank
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/external/Surge/ external
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/icon/ icon
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/rewrite/Surge/ rewrite
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/rule/Surge/ rule/surge
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/rule/AdGuard/ rule/adguard
          rsync -az --exclude={'*.png','*.jpg','*.gif'} --delete ios_rule_script/script/ script
          echo "******  âœ… ios_rule_script æ–‡ä»¶åŒæ­¥å®Œæˆ  ******"
          rm -rf ios_rule_script
          
      - name: å…‹éš† Deezertidal's repo
        uses: actions/checkout@v4
        with:
          repository: deezertidal/Surge_Module
          path: Surge_Module
          
      - name: åŒæ­¥ Surge_Module
        run: |
          echo "******  ğŸš— å¼€å§‹åŒæ­¥æ–‡ä»¶  ******"
          mkdir -p rule/deezertidal
          mkdir -p script/deezertidal
          rsync -az --delete Surge_Module/files/ script/deezertidal
          rsync -az --delete Surge_Module/rule/ rule/deezertidal
          echo "******  âœ… Surge_Module æ–‡ä»¶åŒæ­¥å®Œæˆ  ******"
          rm -rf Surge_Module
      
      - name: è‡ªåŠ¨æäº¤å¹¶æ¨é€å·²åŒæ­¥æ–‡ä»¶
        run: |
          bash ./bin/auto_push.sh
        env:
          GH_TOKEN:  ${{ secrets.GH_TOKEN }}
 